#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ SSH –∫–ª—é—á–µ–π –¥–ª—è GitHub Actions
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: ./scripts/setup-ssh.sh

set -e

echo "üîë –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSH –¥–ª—è GitHub Actions..."

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –∫–ª—é—á–∞
if [ ! -f ~/.ssh/id_ed25519 ]; then
    echo "üìù –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ SSH –∫–ª—é—á–∞..."
    ssh-keygen -t ed25519 -C "github-actions@cheekybot" -f ~/.ssh/id_ed25519 -N ""
    echo "‚úÖ SSH –∫–ª—é—á —Å–æ–∑–¥–∞–Ω"
else
    echo "‚úÖ SSH –∫–ª—é—á —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç"
fi

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
chmod 700 ~/.ssh
chmod 600 ~/.ssh/id_ed25519
chmod 644 ~/.ssh/id_ed25519.pub

echo ""
echo "üìã –ü—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á (–¥–æ–±–∞–≤—å—Ç–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä):"
echo "=========================================="
cat ~/.ssh/id_ed25519.pub
echo "=========================================="

echo ""
echo "üîê –ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á (–¥–æ–±–∞–≤—å—Ç–µ –≤ GitHub Secrets –∫–∞–∫ KEY):"
echo "=========================================="
cat ~/.ssh/id_ed25519
echo "=========================================="

echo ""
echo "üìù –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ:"
echo ""
echo "1. üñ•Ô∏è  –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:"
echo "   ssh-copy-id username@server_ip"
echo "   # –∏–ª–∏ –≤—Ä—É—á–Ω—É—é –¥–æ–±–∞–≤—å—Ç–µ –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –≤ ~/.ssh/authorized_keys"
echo ""
echo "2. üîê –í GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏:"
echo "   Settings ‚Üí Secrets and variables ‚Üí Actions"
echo "   –î–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ —Å–µ–∫—Ä–µ—Ç—ã:"
echo "   - KEY: (–ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á –≤—ã—à–µ)"
echo "   - HOST: IP –∞–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞"
echo "   - USERNAME: –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ"
echo "   - PORT: SSH –ø–æ—Ä—Ç (–æ–±—ã—á–Ω–æ 22)"
echo ""
echo "3. üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:"
echo "   ssh username@server_ip"
echo ""
echo "4. üöÄ –ó–∞–ø—É—Å–∫ –¥–µ–ø–ª–æ—è:"
echo "   git push origin main"
echo ""
echo "‚úÖ SSH –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!" 